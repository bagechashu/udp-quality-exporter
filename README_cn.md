<!-- @format -->

# udp-quality-exporter

# 查看 MTU

```
ip link

```
# 指标

| 指标                     | 图表类型     | 说明             |
| ---------------------- | -------- | -------------- |
| `udp_jitter_ms_avg`    | 折线图      | 平均延迟抖动         |
| `udp_jitter_ms_stddev` | 折线图      | 延迟波动强度         |
| `udp_jitter_ms_cv`     | 折线图或阈值报警 | 稳定性指标（>0.3 警告） |

# 对于音视频通话业务，滑动窗口 window 长度建议如下：

- 常用推荐值：30 秒 ~ 2 分钟 都是合理的选择。
- 行业常见做法：
  - 30 秒：能较快反映网络状态变化，适合实时监控和报警。
  - 60 秒：更平滑，适合统计展示和趋势分析。
  - 2 分钟及以上：适合做历史统计，但对实时性要求高的场景不建议太长。

- 具体建议
  - 实时监控/报警：30 秒~1 分钟
  - 统计展示/趋势分析：1~2 分钟
  - 如果通话流量很稀疏（比如静音时很少包），建议用 1 分钟或更长窗口。

你可以把窗口长度做成参数，实际业务中观察下效果，选择最适合你业务的窗口长度。

# 对于音视频流的 UDP 数据包大小，通常有以下特征：

### 音频流数据包大小

1. 语音通话（VoIP）

- 典型大小: 20-200 字节（不包括协议头）
- 常见编解码器:
- G.711: 约 20-30 字节
- G.729: 约 10-15 字节
- Opus: 20-100 字节（可变）

2. 音乐流

- 典型大小: 100-500 字节
- AAC/MP3 等压缩音频: 通常在 200-400 字节范围

### 视频流数据包大小

1. 实时视频（直播/视频通话）

- 典型大小: 500-1500 字节
- H.264/H.265 编码:
- I 帧: 较大，可达 MTU 上限（约 1500 字节）
- P/B 帧: 相对较小，几十到几百字节

2. 流媒体视频

- 典型大小: 1000-8000 字节（经常分片）
- 适应网络带宽，动态调整码率

### 网络层考虑因素

MTU 限制

- 以太网 MTU: 1500 字节
- IP 头: 20 字节
- UDP 头: 8 字节
- 实际可用载荷: 最多 1472 字节

### 分片情况

超过 MTU 的数据包会被 IP 层分片：

大视频帧经常被分割成多个 UDP 包, 增加了丢包和重传的复杂性

### 实际应用场景

1. WebRTC

  - 音频包: 40-80 字节
  - 视频包: 200-1200 字节
  - 自适应码率调整

2. RTMP/RTSP 流

  - 音频包: 200-500 字节
  - 视频包: 500-1500 字节

3. 游戏音视频

  - 小型音频包: 20-100 字节
  - 位置同步数据: 20-200 字节

### 对监控的影响

由于音视频流具有以下特点，对监控系统提出了殊需求：

- 高频率: 数据包间隔通常在 10-33ms 之间
- 大小变化大: 从几十字节到上千字节
- 实时性要求高: 延迟和抖动直接影响用户体验

因此，监控工具关注抖动和间隔时间是非常合适的，因为这些指标比数据包大小更能反映音视频流的质量。

# 正态分布的数学特性角度 设置 percentile

正态分布有一个非常优美且固定的分布规律，即 “68-95-99.7 法则” 或 “三西格玛法则”。

### 对于一个完美的正态分布：

- 约有 68.27% 的数据落在平均值左右 1 个标准差 的范围内。

- 约有 95.45% 的数据落在平均值左右 2 个标准差 的范围内。

- 约有 99.73% 的数据落在平均值左右 3 个标准差 的范围内。

### 现在我们来回答“多少百分比可以反映基本状态”：

- 反映“典型状态”或“核心趋势”：

  - 约 68% 的数据已经可以反映出分布的中心趋势和最常见的波动范围。如果您说“大部分情况”，这 68%就很有代表性。

- 反映“基本状态”（更全面的描述）：

  - 约 95% 的数据是一个更常被使用的标准。它几乎涵盖了所有常见的情况，只排除了两端各 2.5%的极端情况。在统计学中，95%的置信水平是黄金标准。因此，95%是一个非常强有力的答案，它意味着你已经抓住了该现象几乎全部的基本规律。

- 反映“近乎全部状态”：
  - 约 99.7% 的数据覆盖了几乎所有可能的情况，只留下 0.3%的极端异常值。
